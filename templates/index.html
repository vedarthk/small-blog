{% extends 'base.html' %}

{% block body %}
<div class="container">
  <hr>
  <h2>Small Blog<a href="#" onclick="loadBlogs()" title="Refresh"><i class="icon-repeat"></i></a></h2>
  <hr>
  {% if user %}
    <a href="#post-new" data-toggle="modal">New Post</a>&nbsp;|
    <a href="{% url 'views.user_logout' %}">Logout</a>
  {% else %}
    <a href="#user-login" data-toggle="modal">Login</a>
  {% endif %}
  <hr>

  <!-- Div to display single blog post -->
  <div id="blog-post-single" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3></h3>
    </div>
    <div class="modal-body">
      <p class="post-body">
      </p>
      <p class="post-comments">
      </p>
    </div>
    <div class="modal-footer">
    </div>
  </div>
  <!-- Div for single blog post ends here -->

  <!-- User login form div -->
  <div id="user-login" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Login</h3>
    </div>
    <div class="modal-body">
      <form class="form" method="post" action="{% url 'views.user_login' %}">
        {% csrf_token %}
        <input type="text" name="username" placeholder="username">
        <input type="password" name="password" placeholder="password">
        <input type="submit" value="Login" class="btn btn-success">
      </form>
    </div>
    <div class="modal-footer">
    </div>
  </div>
  <!-- User login form div ends here -->

  <!-- Create new blog post form div -->
  <div id="post-new" class="modal hide fade">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>New Post</h3>
    </div>
    <div class="modal-body">
      <form id="post-new" class="form" method="post" action="{% url 'views.post_new' %}">
        {% csrf_token %}
        <input type="text" name="title" placeholder="title for your blog post" class="span5">
        <textarea name="post" class="span5" rows="10" placeholder="Start typing your blog post here..."></textarea>
    </div>
    <div class="modal-footer">
        <input type="submit" value="Save" class="btn btn-success" style="margin: 0">
        </form>
    </div>
  </div>
  <!-- Create blog post div ends here -->

  <!-- Canvas div where all blog posts are displayed -->
  <div id="canvas">
  </div>
  <!-- End of Canvas div -->
</div>
{% endblock %}


{% block extra_js %}
<script type="text/javascript" src="{{STATIC_URL}}js/custom.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    // Load blog posts fro API
    loadBlogs();

    // Binf createBlogPost() function to form submit
    $("form#post-new").bind('submit', createBlogPost);

    // Display messages from Django if there are any
    {% if messages %}
      {% for message in messages %}
        $("body").append('<div class="alert alert-success fade in"><a class="close pull-right" data-dismiss="alert" href="#">&times;</a>{{ message }}</div>');    
      {% endfor %}
    {% endif %}
    $(".alert").alert()
  });
</script>
{% endblock %}